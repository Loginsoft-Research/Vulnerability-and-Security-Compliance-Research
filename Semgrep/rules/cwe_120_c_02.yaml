rules:
  - id: buffer-copy-without-checking-size-of-input-02
    severity: WARNING
    message: "The use of fseek without checking of $SINK_VAR input size would lead buffer overflows."
    languages:
      - c
    cwe:
      - "CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')"
    references: https://github.com/michael-methner/dlt-daemon/commit/8ac9a080bee25e67e49bd138d81c992ce7b6d899
    mode: taint
    pattern-sources:
      - by-side-effect: true
        patterns:
          - pattern: |
              $RETURN_TYPE $FUNC(..., $TYPE $SOURCE_VAR, ...)
              {
                ...
              }
          - focus-metavariable: $SOURCE_VAR
    pattern-sinks:
      - patterns:
          - pattern: fseek($SINK_BUFF, $VAR[$SINK_VAR], ...)
          - pattern-not-inside: |
              if ($SINK_VAR < 0 || $SINK_VAR >= $COUNTER)
              {
                ...
              }
              ...
          - focus-metavariable: $SINK_VAR
