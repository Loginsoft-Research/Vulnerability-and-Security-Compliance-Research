rules:
  - id: buffer-copy-without-checking-size-of-input-04
    message: The function `$FUN` does not impose any size limitation to what it
      writes to `$BUF`. That may lead to a stack buffer overflow if there is no
      validation on the size of the input.
    severity: WARNING
    cwe:
      - "CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow')"
    references:
      - https://github.com/AenBleidd/FiND/commit/ee2eef34a83644f286c9adcaf30437f92e9c48f1
      - https://github.com/LoicMarechal/libMeshb/commit/8cd68c54e0647c0030ae4506a225ad4a2655c316
    languages:
      - cpp
      - c
    mode: taint
    pattern-sources:
      - by-side-effect: only
        patterns:
          - pattern: $SOURCE_VAR
          - pattern-inside: |
              $RETURN_TYPE $FUN(...)
              {
                ...
                $TYPE $BUF[$SIZE];
                ...
              }
          - focus-metavariable: $SOURCE_VAR
    pattern-sinks:
      - patterns:
          - pattern: $FUNC($SINK_VAR, "$FMT_STRING", ..., <... $BUF ...>)
          - metavariable-regex:
              metavariable: $FMT_STRING
              regex: ^(%s)$
          - metavariable-pattern:
              metavariable: $FUNC
              patterns:
                - pattern-either:
                    - pattern: fscanf
                    - pattern: std::fscanf
                    - pattern: sscanf
                    - pattern: std::sscanf
                    - pattern: fwscanf
                    - pattern: std::fwscanf
                    - pattern: swscanf
                    - pattern: std::swscanf
          - focus-metavariable: $SINK_VAR
