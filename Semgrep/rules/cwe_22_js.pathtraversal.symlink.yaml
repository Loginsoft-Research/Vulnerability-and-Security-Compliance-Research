rules:
- id: pathtraversal-in-symlink
  message: A user supplied file is directly used to copy files without the use of unlink to the destination path could lead to symlink attacks
  languages:
    - javascript
  severity: WARNING
  metadata:
    category: security
    cwe:
      - "CWE-22: Path Traversal"
  pattern-either:
    - patterns:
        - pattern:  $FILE.$CPSYMLINK($SRCPATH, $DESPATH);
        - pattern-not: $FILE.$CPSYMLINK("...", "...");
        - pattern-inside: |
            if ($FILE._isSymbolicLink($SRCPATH))
            {
             ...
            }
        - metavariable-regex:
           metavariable: $CPSYMLINK
           regex: (copySymbolicLink|_copySymbolicLink)
    - patterns:
      - pattern: $FILE.$CPSYMLINK($SRCPATH, $DESPATH);
      - pattern-not: $FILE.$CPSYMLINK("...", "...");
      - metavariable-regex:
           metavariable: $CPSYMLINK
           regex: (copySymbolicLink|_copySymbolicLink)
