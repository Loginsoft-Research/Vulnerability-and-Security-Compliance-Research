import javax.xml.XMLConstants
import javax.xml.parsers.DocumentBuilderFactory 
import org.w3c.dom.Document

//safe
fun String.asXmlDocument(config: XmlParsingConfig = defaultXmlParsingConfig): Document =
    DocumentBuilderFactory
        .newInstance()
        .apply(config)
        .newDocumentBuilder()
        .parse(byteInputStream())

typealias XmlParsingConfig = DocumentBuilderFactory.() -> Unit

val defaultXmlParsingConfig: XmlParsingConfig = {
    isExpandEntityReferences = false
    setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "")
    setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "")
}